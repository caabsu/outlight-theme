{% doc %}
  Adds subtle scroll-triggered fade-in animations to elements.

  Include this snippet once in each section that needs animations.
  Add the 'scroll-animate' class to elements you want to animate.
  Use 'scroll-animate-child' for staggered children animations.

  @example
  {% render 'scroll-animation' %}

  <div class="scroll-animate">Content fades in</div>
  <div class="scroll-animate-group">
    <div class="scroll-animate-child">Staggered 1</div>
    <div class="scroll-animate-child">Staggered 2</div>
  </div>
{% enddoc %}

{% stylesheet %}
  /* Scroll Animation Base Styles */
  .scroll-animate,
  .scroll-animate-child {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-animate.is-visible,
  .scroll-animate-child.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Staggered children delays */
  .scroll-animate-group .scroll-animate-child:nth-child(1) { transition-delay: 0s; }
  .scroll-animate-group .scroll-animate-child:nth-child(2) { transition-delay: 0.1s; }
  .scroll-animate-group .scroll-animate-child:nth-child(3) { transition-delay: 0.2s; }
  .scroll-animate-group .scroll-animate-child:nth-child(4) { transition-delay: 0.3s; }
  .scroll-animate-group .scroll-animate-child:nth-child(5) { transition-delay: 0.4s; }
  .scroll-animate-group .scroll-animate-child:nth-child(6) { transition-delay: 0.5s; }
  .scroll-animate-group .scroll-animate-child:nth-child(7) { transition-delay: 0.6s; }
  .scroll-animate-group .scroll-animate-child:nth-child(8) { transition-delay: 0.7s; }

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .scroll-animate,
    .scroll-animate-child {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    if (typeof window.scrollAnimationInitialized !== 'undefined') return;
    window.scrollAnimationInitialized = true;

    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -50px 0px',
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');

          // If this is a group, animate children
          if (entry.target.classList.contains('scroll-animate-group')) {
            const children = entry.target.querySelectorAll('.scroll-animate-child');
            children.forEach(child => child.classList.add('is-visible'));
          }

          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    function initScrollAnimations() {
      document.querySelectorAll('.scroll-animate:not(.is-visible)').forEach(el => observer.observe(el));
      document.querySelectorAll('.scroll-animate-group:not(.is-visible)').forEach(el => observer.observe(el));
    }

    // Initialize on load and after any dynamic content changes
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initScrollAnimations);
    } else {
      initScrollAnimations();
    }

    // Re-initialize when Shopify section is rendered
    document.addEventListener('shopify:section:load', initScrollAnimations);
  })();
{% endjavascript %}
