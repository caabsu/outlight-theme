{% comment %}
  Featured Collection page (Best Sellers / New Arrivals) with category tabs
{% endcomment %}

<div class="collection-featured" data-collection-featured>
  {%- comment -%} Hero Section {%- endcomment -%}
  <div class="collection-featured-hero full-width" style="
    --hero-height-mobile: {{ section.settings.hero_height_mobile }}px;
    --hero-height-desktop: {{ section.settings.hero_height_desktop }}px;
    --hero-overlay-opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
    --content-padding-x-mobile: {{ section.settings.content_padding_x_mobile }}px;
    --content-padding-x-desktop: {{ section.settings.content_padding_x_desktop }}px;
    --content-padding-bottom-mobile: {{ section.settings.content_padding_bottom_mobile }}px;
    --content-padding-bottom-desktop: {{ section.settings.content_padding_bottom_desktop }}px;
    --title-size-mobile: {{ section.settings.title_size_mobile }}px;
    --title-size-desktop: {{ section.settings.title_size_desktop }}px;
    --title-color: {{ section.settings.title_color }};
    --title-weight: {{ section.settings.title_weight }};
    --subtitle-size-mobile: {{ section.settings.subtitle_size_mobile }}px;
    --subtitle-size-desktop: {{ section.settings.subtitle_size_desktop }}px;
    --subtitle-color: {{ section.settings.subtitle_color }};
  ">
    <div class="collection-featured-hero__image-wrapper">
      {%- if section.settings.hero_image != blank -%}
        {{ section.settings.hero_image | image_url: width: 1920 | image_tag: class: 'collection-featured-hero__image', loading: 'eager' }}
      {%- elsif collection.image -%}
        {{ collection.image | image_url: width: 1920 | image_tag: class: 'collection-featured-hero__image', loading: 'eager' }}
      {%- else -%}
        <div class="collection-featured-hero__placeholder"></div>
      {%- endif -%}
      <div class="collection-featured-hero__overlay"></div>
    </div>

    <div class="collection-featured-hero__content">
      <h1 class="collection-featured-hero__title">{{ section.settings.custom_title | default: collection.title }}</h1>
      {%- if section.settings.subtitle != blank -%}
        <p class="collection-featured-hero__subtitle">{{ section.settings.subtitle }}</p>
      {%- endif -%}
    </div>
  </div>

  {%- comment -%} Category Tabs {%- endcomment -%}
  <div class="collection-featured-tabs" style="
    --tabs-bg: {{ section.settings.tabs_bg }};
    --tab-inactive-bg: {{ section.settings.tab_inactive_bg }};
    --tab-active-bg: {{ section.settings.tab_active_bg }};
    --tab-text-color: {{ section.settings.tab_text_color }};
    --tab-active-text-color: {{ section.settings.tab_active_text_color }};
    --tab-text-size: {{ section.settings.tab_text_size }}px;
    --tab-text-weight: {{ section.settings.tab_text_weight }};
    --tab-icon-size: {{ section.settings.tab_icon_size }}px;
  ">
    <div class="collection-featured-tabs__inner">
      {%- comment -%} ALL Tab {%- endcomment -%}
      <a href="{{ collection.url }}" class="collection-featured-tab{% unless request.path contains '/collections/' and request.path != collection.url %} is-active{% endunless %}" data-tab="all">
        <span class="collection-featured-tab__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="7" height="7" rx="1"></rect>
            <rect x="14" y="3" width="7" height="7" rx="1"></rect>
            <rect x="3" y="14" width="7" height="7" rx="1"></rect>
            <rect x="14" y="14" width="7" height="7" rx="1"></rect>
          </svg>
        </span>
        <span class="collection-featured-tab__label">{{ section.settings.tab_all_text | default: 'ALL' }}</span>
      </a>

      {%- comment -%} Category 1 {%- endcomment -%}
      {% if section.settings.tab_1_collection != blank %}
        <a href="{{ section.settings.tab_1_collection.url }}" class="collection-featured-tab{% if collection.handle == section.settings.tab_1_collection.handle %} is-active{% endif %}">
          <span class="collection-featured-tab__icon">
            {%- comment -%} Table/Desk Lamp icon {%- endcomment -%}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 21h6M12 17v4M8 17h8"></path>
              <path d="M7 17l1-10h8l1 10"></path>
              <path d="M8 7c0-2 1.5-4 4-4s4 2 4 4"></path>
            </svg>
          </span>
          <span class="collection-featured-tab__label">{{ section.settings.tab_1_text | default: 'TABLE' }}</span>
        </a>
      {% endif %}

      {%- comment -%} Category 2 {%- endcomment -%}
      {% if section.settings.tab_2_collection != blank %}
        <a href="{{ section.settings.tab_2_collection.url }}" class="collection-featured-tab{% if collection.handle == section.settings.tab_2_collection.handle %} is-active{% endif %}">
          <span class="collection-featured-tab__icon">
            {%- comment -%} Floor Lamp icon {%- endcomment -%}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 21h6M12 10v11"></path>
              <path d="M8 10l4-7 4 7H8z"></path>
            </svg>
          </span>
          <span class="collection-featured-tab__label">{{ section.settings.tab_2_text | default: 'FLOOR' }}</span>
        </a>
      {% endif %}

      {%- comment -%} Category 3 {%- endcomment -%}
      {% if section.settings.tab_3_collection != blank %}
        <a href="{{ section.settings.tab_3_collection.url }}" class="collection-featured-tab{% if collection.handle == section.settings.tab_3_collection.handle %} is-active{% endif %}">
          <span class="collection-featured-tab__icon">
            {%- comment -%} Ceiling/Pendant icon {%- endcomment -%}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 2v4M12 6l-4 6h8l-4-6z"></path>
              <circle cx="12" cy="15" r="3"></circle>
              <path d="M9 15l-2 6h10l-2-6"></path>
            </svg>
          </span>
          <span class="collection-featured-tab__label">{{ section.settings.tab_3_text | default: 'CEILING' }}</span>
        </a>
      {% endif %}

      {%- comment -%} Category 4 {%- endcomment -%}
      {% if section.settings.tab_4_collection != blank %}
        <a href="{{ section.settings.tab_4_collection.url }}" class="collection-featured-tab{% if collection.handle == section.settings.tab_4_collection.handle %} is-active{% endif %}">
          <span class="collection-featured-tab__icon">
            {%- comment -%} Wall icon {%- endcomment -%}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M3 3v18M7 12h4"></path>
              <circle cx="14" cy="12" r="4"></circle>
              <path d="M18 12h3"></path>
            </svg>
          </span>
          <span class="collection-featured-tab__label">{{ section.settings.tab_4_text | default: 'WALL' }}</span>
        </a>
      {% endif %}

      {%- comment -%} Category 5 {%- endcomment -%}
      {% if section.settings.tab_5_collection != blank %}
        <a href="{{ section.settings.tab_5_collection.url }}" class="collection-featured-tab{% if collection.handle == section.settings.tab_5_collection.handle %} is-active{% endif %}">
          <span class="collection-featured-tab__icon">
            {%- comment -%} Chandelier icon {%- endcomment -%}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 2v3M12 5l-6 4M12 5l6 4"></path>
              <circle cx="6" cy="12" r="2"></circle>
              <circle cx="12" cy="10" r="2"></circle>
              <circle cx="18" cy="12" r="2"></circle>
              <path d="M6 14v3M12 12v5M18 14v3"></path>
            </svg>
          </span>
          <span class="collection-featured-tab__label">{{ section.settings.tab_5_text | default: 'CHANDELIER' }}</span>
        </a>
      {% endif %}

      {%- comment -%} Divider {%- endcomment -%}
      <span class="collection-featured-tabs__divider"></span>

      {%- comment -%} Filter Button {%- endcomment -%}
      <button type="button" class="collection-featured-tab collection-featured-tab--filter" data-filter-toggle>
        <span class="collection-featured-tab__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="4" y1="6" x2="20" y2="6"></line>
            <line x1="4" y1="12" x2="20" y2="12"></line>
            <line x1="4" y1="18" x2="20" y2="18"></line>
            <circle cx="8" cy="6" r="2" fill="currentColor"></circle>
            <circle cx="16" cy="12" r="2" fill="currentColor"></circle>
            <circle cx="10" cy="18" r="2" fill="currentColor"></circle>
          </svg>
        </span>
        <span class="collection-featured-tab__label">{{ section.settings.filter_text | default: 'FILTER' }}</span>
      </button>

      {%- comment -%} Sort Button {%- endcomment -%}
      <button type="button" class="collection-featured-tab collection-featured-tab--sort" data-sort-toggle>
        <span class="collection-featured-tab__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="4" y1="6" x2="14" y2="6"></line>
            <line x1="4" y1="12" x2="11" y2="12"></line>
            <line x1="4" y1="18" x2="8" y2="18"></line>
            <polyline points="15 15 18 18 21 15"></polyline>
            <line x1="18" y1="6" x2="18" y2="18"></line>
          </svg>
        </span>
        <span class="collection-featured-tab__label">{{ section.settings.sort_text | default: 'SORT' }}</span>
      </button>
    </div>
  </div>

  {%- comment -%} Sort Dropdown {%- endcomment -%}
  <div class="collection-featured-sort" data-sort-dropdown hidden>
    <div class="collection-featured-sort__inner">
      <button type="button" class="collection-featured-sort__close" data-sort-close>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <h3 class="collection-featured-sort__title">Sort By</h3>
      <div class="collection-featured-sort__options">
        {% assign sort_options = 'manual,best-selling,title-ascending,title-descending,price-ascending,price-descending,created-ascending,created-descending' | split: ',' %}
        {% assign sort_labels = 'Featured,Best Selling,A-Z,Z-A,Price: Low to High,Price: High to Low,Oldest,Newest' | split: ',' %}
        {% for option in sort_options %}
          <button type="button" class="collection-featured-sort__option{% if collection.sort_by == option or option == 'manual' and collection.sort_by == blank %} is-active{% endif %}" data-sort-option="{{ option }}">
            {{ sort_labels[forloop.index0] }}
          </button>
        {% endfor %}
      </div>
    </div>
  </div>

  {%- comment -%} Filter Modal {%- endcomment -%}
  <div class="collection-featured-filter" data-filter-modal hidden>
    <div class="collection-featured-filter__backdrop" data-filter-close></div>
    <div class="collection-featured-filter__content">
      <div class="collection-featured-filter__header">
        <h3 class="collection-featured-filter__title">Filters</h3>
        <button type="button" class="collection-featured-filter__close" data-filter-close>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="collection-featured-filter__body">
        {%- comment -%} Price Filter {%- endcomment -%}
        <div class="collection-featured-filter-group">
          <h4 class="collection-featured-filter-group__title">Price Range</h4>
          <div class="collection-featured-filter-price">
            <div class="collection-featured-filter-price__input">
              <label>Min</label>
              <input type="number" data-price-min placeholder="0" min="0">
            </div>
            <span class="collection-featured-filter-price__separator">â€”</span>
            <div class="collection-featured-filter-price__input">
              <label>Max</label>
              <input type="number" data-price-max placeholder="Any" min="0">
            </div>
          </div>
        </div>

        {%- comment -%} Category Filter {%- endcomment -%}
        <div class="collection-featured-filter-group">
          <h4 class="collection-featured-filter-group__title">Category</h4>
          <div class="collection-featured-filter-cats">
            {% if section.settings.filter_collection_1 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_1.handle }}">
                {{ section.settings.filter_collection_1_text | default: section.settings.filter_collection_1.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_2 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_2.handle }}">
                {{ section.settings.filter_collection_2_text | default: section.settings.filter_collection_2.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_3 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_3.handle }}">
                {{ section.settings.filter_collection_3_text | default: section.settings.filter_collection_3.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_4 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_4.handle }}">
                {{ section.settings.filter_collection_4_text | default: section.settings.filter_collection_4.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_5 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_5.handle }}">
                {{ section.settings.filter_collection_5_text | default: section.settings.filter_collection_5.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_6 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_6.handle }}">
                {{ section.settings.filter_collection_6_text | default: section.settings.filter_collection_6.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_7 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_7.handle }}">
                {{ section.settings.filter_collection_7_text | default: section.settings.filter_collection_7.title }}
              </button>
            {% endif %}
            {% if section.settings.filter_collection_8 != blank %}
              <button type="button" class="collection-featured-filter-cat" data-filter-cat="{{ section.settings.filter_collection_8.handle }}">
                {{ section.settings.filter_collection_8_text | default: section.settings.filter_collection_8.title }}
              </button>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="collection-featured-filter__footer">
        <button type="button" class="collection-featured-filter__clear" data-filter-clear>Clear All</button>
        <button type="button" class="collection-featured-filter__apply" data-filter-apply>Apply</button>
      </div>
    </div>
  </div>

  {%- comment -%} Products Grid {%- endcomment -%}
  <div class="collection-featured-products" style="
    --products-gap: {{ section.settings.products_gap }}px;
    --products-padding-x-mobile: {{ section.settings.products_padding_x_mobile }}px;
    --products-padding-x-desktop: {{ section.settings.products_padding_x_desktop }}px;
    --products-padding-top: {{ section.settings.products_padding_top }}px;
    --products-padding-bottom: {{ section.settings.products_padding_bottom }}px;
    --product-title-size: {{ section.settings.product_title_size }}px;
    --product-title-color: {{ section.settings.product_title_color }};
    --product-title-weight: {{ section.settings.product_title_weight }};
    --product-price-size: {{ section.settings.product_price_size }}px;
    --product-price-color: {{ section.settings.product_price_color }};
  ">
    {% paginate collection.products by section.settings.products_per_page %}
      <div class="collection-featured-products__grid" data-products-grid>
        {% for product in collection.products %}
          {%- capture product_collections -%}
            {%- for col in product.collections -%}{{ col.handle }}{% unless forloop.last %},{% endunless %}{%- endfor -%}
          {%- endcapture -%}
          <a href="{{ product.url }}" class="collection-featured-product" data-product data-collections="{{ product_collections }}" data-title="{{ product.title | downcase }}" data-price="{{ product.price }}">
            <div class="collection-featured-product__image-wrapper">
              {% if product.featured_image %}
                {{ product.featured_image | image_url: width: 600, height: 600, crop: 'center' | image_tag: class: 'collection-featured-product__image', loading: 'lazy' }}
              {% else %}
                <div class="collection-featured-product__placeholder"></div>
              {% endif %}
            </div>
            <div class="collection-featured-product__content">
              <h3 class="collection-featured-product__title">{{ product.title }}</h3>
              <p class="collection-featured-product__price">{{ product.price | money }}</p>
            </div>
          </a>
        {% endfor %}
      </div>

      {%- if paginate.pages > 1 -%}
        <div class="collection-featured-pagination">
          {{ paginate | default_pagination }}
        </div>
      {%- endif -%}
    {% endpaginate %}
  </div>
</div>

{% stylesheet %}
  .collection-featured {
    width: 100%;
  }

  /* Hero Section */
  .collection-featured-hero {
    position: relative;
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    height: var(--hero-height-mobile, 300px);
    overflow: hidden;
  }

  .collection-featured-hero__image-wrapper {
    position: absolute;
    inset: 0;
  }

  .collection-featured-hero__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .collection-featured-hero__placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #E7E5E4 0%, #D6D3D1 100%);
  }

  .collection-featured-hero__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, var(--hero-overlay-opacity, 0.3));
  }

  .collection-featured-hero__content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: flex-start;
    padding-left: var(--content-padding-x-mobile, 24px);
    padding-right: var(--content-padding-x-mobile, 24px);
    padding-bottom: var(--content-padding-bottom-mobile, 24px);
    z-index: 1;
  }

  .collection-featured-hero__title {
    font-family: var(--font-heading-family), serif;
    font-size: var(--title-size-mobile, 36px);
    font-weight: var(--title-weight, 400);
    color: var(--title-color, #ffffff);
    margin: 0;
    line-height: 1.1;
  }

  .collection-featured-hero__subtitle {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--subtitle-size-mobile, 14px);
    color: var(--subtitle-color, rgba(255, 255, 255, 0.8));
    margin: 8px 0 0;
    line-height: 1.4;
  }

  /* Category Tabs - Modern Compact Design */
  .collection-featured-tabs {
    padding: 12px 16px;
    background: var(--tabs-bg, #ffffff);
  }

  .collection-featured-tabs__inner {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 6px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding: 2px;
  }

  .collection-featured-tabs__inner::-webkit-scrollbar {
    display: none;
  }

  .collection-featured-tab {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: var(--tab-inactive-bg, #F5F5F4);
    border: none;
    border-radius: 100px;
    cursor: pointer;
    text-decoration: none;
    color: var(--tab-text-color, #78716C);
    transition: all 0.15s ease;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .collection-featured-tab__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
  }

  .collection-featured-tab__icon svg {
    width: 16px;
    height: 16px;
  }

  .collection-featured-tab__label {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--tab-text-size, 12px);
    font-weight: var(--tab-text-weight, 500);
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .collection-featured-tab.is-active {
    background: var(--tab-active-bg, #1C1917);
    color: var(--tab-active-text-color, #ffffff);
  }

  .collection-featured-tab:hover:not(.is-active) {
    background: #E7E5E4;
  }

  /* Divider between categories and actions */
  .collection-featured-tabs__divider {
    width: 1px;
    height: 24px;
    background: #E5E5E5;
    margin: 0 6px;
    flex-shrink: 0;
  }

  /* Filter/Sort action buttons */
  .collection-featured-tab--filter,
  .collection-featured-tab--sort {
    background: transparent;
    border: 1px solid #E5E5E5;
  }

  .collection-featured-tab--filter:hover,
  .collection-featured-tab--sort:hover {
    background: #F5F5F4;
    border-color: #D6D3D1;
  }

  /* Sort Dropdown */
  .collection-featured-sort {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1000;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .collection-featured-sort[hidden] {
    display: none;
  }

  .collection-featured-sort__inner {
    position: relative;
    background: #ffffff;
    width: 100%;
    max-width: 500px;
    border-radius: 16px 16px 0 0;
    padding: 24px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .collection-featured-sort__close {
    position: absolute;
    top: 16px;
    right: 16px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: #78716C;
  }

  .collection-featured-sort__title {
    font-family: var(--font-heading-family), serif;
    font-size: 20px;
    font-weight: 400;
    margin: 0 0 20px;
    color: #1C1917;
  }

  .collection-featured-sort__options {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .collection-featured-sort__option {
    display: block;
    width: 100%;
    text-align: left;
    padding: 14px 16px;
    background: none;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: var(--font-body-family), sans-serif;
    font-size: 16px;
    color: #1C1917;
    transition: background-color 0.2s ease;
  }

  .collection-featured-sort__option:hover {
    background-color: #F5F5F4;
  }

  .collection-featured-sort__option.is-active {
    background-color: #1C1917;
    color: #ffffff;
  }

  /* Filter Modal */
  .collection-featured-filter {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .collection-featured-filter[hidden] {
    display: none;
  }

  .collection-featured-filter__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
  }

  .collection-featured-filter__content {
    position: relative;
    background: #ffffff;
    width: 100%;
    max-width: 500px;
    border-radius: 16px 16px 0 0;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
  }

  .collection-featured-filter__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid #E5E5E5;
  }

  .collection-featured-filter__title {
    font-family: var(--font-heading-family), serif;
    font-size: 20px;
    font-weight: 400;
    margin: 0;
    color: #1C1917;
  }

  .collection-featured-filter__close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: #78716C;
  }

  .collection-featured-filter__body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
  }

  .collection-featured-filter-group {
    margin-bottom: 32px;
  }

  .collection-featured-filter-group:last-child {
    margin-bottom: 0;
  }

  .collection-featured-filter-group__title {
    font-family: var(--font-body-family), sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #78716C;
    margin: 0 0 16px;
  }

  .collection-featured-filter-price {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .collection-featured-filter-price__input {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .collection-featured-filter-price__input label {
    font-size: 12px;
    color: #78716C;
  }

  .collection-featured-filter-price__input input {
    padding: 12px;
    border: 1px solid #E5E5E5;
    border-radius: 8px;
    font-size: 16px;
    width: 100%;
  }

  .collection-featured-filter-price__separator {
    color: #A8A29E;
    padding-top: 20px;
  }

  .collection-featured-filter-cats {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .collection-featured-filter-cat {
    padding: 10px 16px;
    background: #F5F5F4;
    border-radius: 50px;
    font-family: var(--font-body-family), sans-serif;
    font-size: 14px;
    color: #1C1917;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .collection-featured-filter-cat:hover {
    background: #E7E5E4;
  }

  .collection-featured-filter-cat.is-active {
    background: #1C1917;
    color: #ffffff;
  }

  .collection-featured-filter__footer {
    display: flex;
    gap: 12px;
    padding: 20px 24px;
    border-top: 1px solid #E5E5E5;
  }

  .collection-featured-filter__clear {
    flex: 1;
    padding: 14px 24px;
    background: none;
    border: 1px solid #E5E5E5;
    border-radius: 8px;
    cursor: pointer;
    font-family: var(--font-body-family), sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #78716C;
  }

  .collection-featured-filter__apply {
    flex: 1;
    padding: 14px 24px;
    background: #1C1917;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: var(--font-body-family), sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #ffffff;
  }

  /* Products Grid */
  .collection-featured-products {
    padding-top: var(--products-padding-top, 24px);
    padding-bottom: var(--products-padding-bottom, 48px);
    padding-left: var(--products-padding-x-mobile, 12px);
    padding-right: var(--products-padding-x-mobile, 12px);
  }

  .collection-featured-products__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--products-gap, 16px);
  }

  .collection-featured-product {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .collection-featured-product__image-wrapper {
    aspect-ratio: 1 / 1;
    overflow: hidden;
    background-color: #f5f5f5;
    margin-bottom: 12px;
  }

  .collection-featured-product__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .collection-featured-product:hover .collection-featured-product__image {
    transform: scale(1.03);
  }

  .collection-featured-product__placeholder {
    width: 100%;
    height: 100%;
    background-color: #e5e5e5;
  }

  .collection-featured-product__content {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 8px;
    padding: 0 4px;
  }

  .collection-featured-product__title {
    font-family: var(--font-heading-family), serif;
    font-size: var(--product-title-size, 16px);
    font-weight: var(--product-title-weight, 400);
    color: var(--product-title-color, #1C1917);
    margin: 0;
    line-height: 1.3;
    flex: 1;
  }

  .collection-featured-product__price {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--product-price-size, 14px);
    color: var(--product-price-color, #78716C);
    margin: 0;
    flex-shrink: 0;
  }

  .collection-featured-pagination {
    margin-top: 48px;
    margin-bottom: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    flex-wrap: wrap;
  }

  .collection-featured-pagination a,
  .collection-featured-pagination span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    padding: 0 12px;
    font-family: var(--font-body-family), sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #57534E;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .collection-featured-pagination a:hover {
    background: #F5F5F4;
    color: #1C1917;
  }

  .collection-featured-pagination span.current {
    background: #1C1917;
    color: #ffffff;
    font-weight: 600;
  }

  .collection-featured-pagination span.deco {
    min-width: auto;
    padding: 0 4px;
    color: #A8A29E;
  }

  @media (max-width: 767px) {
    .collection-featured-pagination {
      gap: 2px;
    }

    .collection-featured-pagination a,
    .collection-featured-pagination span {
      min-width: 36px;
      height: 36px;
      padding: 0 8px;
      font-size: 13px;
      border-radius: 6px;
    }
  }

  /* Desktop */
  @media (min-width: 768px) {
    .collection-featured-hero {
      height: var(--hero-height-desktop, 450px);
    }

    .collection-featured-hero__content {
      padding-left: var(--content-padding-x-desktop, 60px);
      padding-right: var(--content-padding-x-desktop, 60px);
      padding-bottom: var(--content-padding-bottom-desktop, 60px);
    }

    .collection-featured-hero__title {
      font-size: var(--title-size-desktop, 56px);
    }

    .collection-featured-hero__subtitle {
      font-size: var(--subtitle-size-desktop, 16px);
      margin-top: 12px;
    }

    .collection-featured-tabs {
      padding: 16px 40px;
    }

    .collection-featured-tabs__inner {
      justify-content: center;
      gap: 8px;
    }

    .collection-featured-tab {
      padding: 10px 18px;
    }

    .collection-featured-tabs__divider {
      height: 28px;
      margin: 0 12px;
    }

    .collection-featured-products {
      padding-left: var(--products-padding-x-desktop, 24px);
      padding-right: var(--products-padding-x-desktop, 24px);
    }

    .collection-featured-products__grid {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--products-gap, 24px);
    }

    .collection-featured-product__image-wrapper {
      margin-bottom: 16px;
    }

    .collection-featured-product__title {
      font-size: calc(var(--product-title-size, 16px) + 2px);
    }

    .collection-featured-sort__inner,
    .collection-featured-filter__content {
      border-radius: 16px;
      margin-bottom: 40px;
    }

    .collection-featured-sort {
      align-items: center;
    }

    .collection-featured-filter {
      align-items: center;
    }
  }

  @media (min-width: 1024px) {
    .collection-featured-products__grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    const container = document.querySelector('[data-collection-featured]');
    if (!container) return;

    // Shared elements
    const products = container.querySelectorAll('[data-product]');
    const filterCats = container.querySelectorAll('[data-filter-cat]');
    let selectedCategories = new Set();
    let currentSearchTerm = '';

    // Price filter values
    let priceMinValue = null;
    let priceMaxValue = null;

    // Combined filter function
    const applyAllFilters = () => {
      products.forEach(product => {
        const productCollections = (product.dataset.collections || '').split(',').map(c => c.trim());
        const productTitle = product.dataset.title || '';
        const productPrice = parseInt(product.dataset.price || '0', 10); // Price in cents

        // If searching, ignore category filter and search ALL products
        if (currentSearchTerm) {
          const matchesSearch = productTitle.includes(currentSearchTerm);
          product.style.display = matchesSearch ? '' : 'none';
          return;
        }

        // Category filter - must match ALL selected categories (AND logic)
        let matchesCategory = true;
        if (selectedCategories.size > 0) {
          matchesCategory = [...selectedCategories].every(cat => productCollections.includes(cat));
        }

        // Price filter (convert dollars to cents for comparison)
        let matchesPrice = true;
        if (priceMinValue !== null) {
          matchesPrice = matchesPrice && (productPrice >= priceMinValue * 100);
        }
        if (priceMaxValue !== null) {
          matchesPrice = matchesPrice && (productPrice <= priceMaxValue * 100);
        }

        product.style.display = (matchesCategory && matchesPrice) ? '' : 'none';
      });
    };

    // Sort functionality
    const sortToggle = container.querySelector('[data-sort-toggle]');
    const sortDropdown = container.querySelector('[data-sort-dropdown]');
    const sortClose = container.querySelector('[data-sort-close]');
    const sortOptions = container.querySelectorAll('[data-sort-option]');

    if (sortToggle && sortDropdown) {
      sortToggle.addEventListener('click', () => {
        sortDropdown.hidden = false;
        document.body.style.overflow = 'hidden';
      });

      const closeSort = () => {
        sortDropdown.hidden = true;
        document.body.style.overflow = '';
      };

      if (sortClose) sortClose.addEventListener('click', closeSort);
      sortDropdown.addEventListener('click', (e) => {
        if (e.target === sortDropdown) closeSort();
      });

      sortOptions.forEach(option => {
        option.addEventListener('click', () => {
          const sortBy = option.dataset.sortOption;
          const url = new URL(window.location.href);
          url.searchParams.set('sort_by', sortBy);
          window.location.href = url.toString();
        });
      });
    }

    // Filter functionality
    const filterToggle = container.querySelector('[data-filter-toggle]');
    const filterModal = container.querySelector('[data-filter-modal]');
    const filterCloses = container.querySelectorAll('[data-filter-close]');
    const filterClear = container.querySelector('[data-filter-clear]');
    const filterApply = container.querySelector('[data-filter-apply]');
    const priceMin = container.querySelector('[data-price-min]');
    const priceMax = container.querySelector('[data-price-max]');

    if (filterToggle && filterModal) {
      filterToggle.addEventListener('click', () => {
        filterModal.hidden = false;
        document.body.style.overflow = 'hidden';
      });

      const closeFilter = () => {
        filterModal.hidden = true;
        document.body.style.overflow = '';
      };

      filterCloses.forEach(btn => btn.addEventListener('click', closeFilter));

      // Category filter toggle
      filterCats.forEach(btn => {
        btn.addEventListener('click', () => {
          const cat = btn.dataset.filterCat;
          if (selectedCategories.has(cat)) {
            selectedCategories.delete(cat);
            btn.classList.remove('is-active');
          } else {
            selectedCategories.add(cat);
            btn.classList.add('is-active');
          }
        });
      });

      if (filterClear) {
        filterClear.addEventListener('click', () => {
          if (priceMin) priceMin.value = '';
          if (priceMax) priceMax.value = '';
          priceMinValue = null;
          priceMaxValue = null;
          selectedCategories.clear();
          filterCats.forEach(btn => btn.classList.remove('is-active'));
          applyAllFilters();
        });
      }

      if (filterApply) {
        filterApply.addEventListener('click', () => {
          // Capture price filter values
          if (priceMin && priceMin.value) {
            priceMinValue = parseFloat(priceMin.value);
          } else {
            priceMinValue = null;
          }
          if (priceMax && priceMax.value) {
            priceMaxValue = parseFloat(priceMax.value);
          } else {
            priceMaxValue = null;
          }
          applyAllFilters();
          closeFilter();
        });
      }
    }

    // ESC key closes all modals
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (sortDropdown && !sortDropdown.hidden) {
          sortDropdown.hidden = true;
          document.body.style.overflow = '';
        }
        if (filterModal && !filterModal.hidden) {
          filterModal.hidden = true;
          document.body.style.overflow = '';
        }
      }
    });
  })();
{% endjavascript %}

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "header",
      "content": "Hero Image"
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Custom hero image",
      "info": "Uses collection image by default"
    },
    {
      "type": "range",
      "id": "hero_height_mobile",
      "label": "Hero height (mobile)",
      "min": 200,
      "max": 500,
      "step": 25,
      "unit": "px",
      "default": 300
    },
    {
      "type": "range",
      "id": "hero_height_desktop",
      "label": "Hero height (desktop)",
      "min": 300,
      "max": 700,
      "step": 25,
      "unit": "px",
      "default": 450
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "%",
      "default": 30
    },
    {
      "type": "header",
      "content": "Content Position"
    },
    {
      "type": "range",
      "id": "content_padding_x_mobile",
      "label": "Horizontal padding (mobile)",
      "min": 16,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "content_padding_x_desktop",
      "label": "Horizontal padding (desktop)",
      "min": 20,
      "max": 160,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "content_padding_bottom_mobile",
      "label": "Bottom padding (mobile)",
      "min": 16,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "content_padding_bottom_desktop",
      "label": "Bottom padding (desktop)",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "header",
      "content": "Title"
    },
    {
      "type": "text",
      "id": "custom_title",
      "label": "Custom title"
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Title size (mobile)",
      "min": 24,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "title_size_desktop",
      "label": "Title size (desktop)",
      "min": 32,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 56
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Title weight",
      "options": [
        { "value": "300", "label": "Light" },
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" }
      ],
      "default": "400"
    },
    {
      "type": "header",
      "content": "Subtitle"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle"
    },
    {
      "type": "range",
      "id": "subtitle_size_mobile",
      "label": "Subtitle size (mobile)",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "subtitle_size_desktop",
      "label": "Subtitle size (desktop)",
      "min": 14,
      "max": 28,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Category Tabs"
    },
    {
      "type": "color",
      "id": "tabs_bg",
      "label": "Tabs section background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "tab_inactive_bg",
      "label": "Inactive tab icon background",
      "default": "#F5F5F4"
    },
    {
      "type": "color",
      "id": "tab_active_bg",
      "label": "Active tab icon background",
      "default": "#1C1917"
    },
    {
      "type": "color",
      "id": "tab_text_color",
      "label": "Tab text color",
      "default": "#78716C"
    },
    {
      "type": "color",
      "id": "tab_active_text_color",
      "label": "Active tab icon color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "tab_text_size",
      "label": "Tab text size",
      "min": 9,
      "max": 14,
      "step": 1,
      "unit": "px",
      "default": 11
    },
    {
      "type": "select",
      "id": "tab_text_weight",
      "label": "Tab text weight",
      "options": [
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "500"
    },
    {
      "type": "range",
      "id": "tab_icon_size",
      "label": "Tab icon size",
      "min": 18,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "text",
      "id": "tab_all_text",
      "label": "ALL tab text",
      "default": "ALL"
    },
    {
      "type": "header",
      "content": "Tab 1"
    },
    {
      "type": "collection",
      "id": "tab_1_collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "tab_1_text",
      "label": "Label",
      "default": "TABLE"
    },
    {
      "type": "header",
      "content": "Tab 2"
    },
    {
      "type": "collection",
      "id": "tab_2_collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "tab_2_text",
      "label": "Label",
      "default": "FLOOR"
    },
    {
      "type": "header",
      "content": "Tab 3"
    },
    {
      "type": "collection",
      "id": "tab_3_collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "tab_3_text",
      "label": "Label",
      "default": "CEILING"
    },
    {
      "type": "header",
      "content": "Tab 4"
    },
    {
      "type": "collection",
      "id": "tab_4_collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "tab_4_text",
      "label": "Label",
      "default": "WALL"
    },
    {
      "type": "header",
      "content": "Tab 5"
    },
    {
      "type": "collection",
      "id": "tab_5_collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "tab_5_text",
      "label": "Label",
      "default": "CHANDELIER"
    },
    {
      "type": "header",
      "content": "Filter / Sort Buttons"
    },
    {
      "type": "text",
      "id": "filter_text",
      "label": "Filter button text",
      "default": "FILTER"
    },
    {
      "type": "text",
      "id": "sort_text",
      "label": "Sort button text",
      "default": "SORT"
    },
    {
      "type": "header",
      "content": "Filter Collections"
    },
    {
      "type": "collection",
      "id": "filter_collection_1",
      "label": "Collection 1"
    },
    {
      "type": "text",
      "id": "filter_collection_1_text",
      "label": "Collection 1 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_2",
      "label": "Collection 2"
    },
    {
      "type": "text",
      "id": "filter_collection_2_text",
      "label": "Collection 2 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_3",
      "label": "Collection 3"
    },
    {
      "type": "text",
      "id": "filter_collection_3_text",
      "label": "Collection 3 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_4",
      "label": "Collection 4"
    },
    {
      "type": "text",
      "id": "filter_collection_4_text",
      "label": "Collection 4 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_5",
      "label": "Collection 5"
    },
    {
      "type": "text",
      "id": "filter_collection_5_text",
      "label": "Collection 5 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_6",
      "label": "Collection 6"
    },
    {
      "type": "text",
      "id": "filter_collection_6_text",
      "label": "Collection 6 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_7",
      "label": "Collection 7"
    },
    {
      "type": "text",
      "id": "filter_collection_7_text",
      "label": "Collection 7 label"
    },
    {
      "type": "collection",
      "id": "filter_collection_8",
      "label": "Collection 8"
    },
    {
      "type": "text",
      "id": "filter_collection_8_text",
      "label": "Collection 8 label"
    },
    {
      "type": "header",
      "content": "Products Grid"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 20
    },
    {
      "type": "range",
      "id": "products_gap",
      "label": "Gap between products",
      "min": 4,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "products_padding_x_mobile",
      "label": "Side padding (mobile)",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "products_padding_x_desktop",
      "label": "Side padding (desktop)",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "products_padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "products_padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 48
    },
    {
      "type": "header",
      "content": "Product Title"
    },
    {
      "type": "range",
      "id": "product_title_size",
      "label": "Product title size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product title color",
      "default": "#1C1917"
    },
    {
      "type": "select",
      "id": "product_title_weight",
      "label": "Product title weight",
      "options": [
        { "value": "300", "label": "Light" },
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" }
      ],
      "default": "400"
    },
    {
      "type": "header",
      "content": "Product Price"
    },
    {
      "type": "range",
      "id": "product_price_size",
      "label": "Product price size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "color",
      "id": "product_price_color",
      "label": "Product price color",
      "default": "#78716C"
    }
  ],
  "templates": ["collection"]
}
{% endschema %}
