{%- liquid
  assign installation_metafield = product.metafields.custom.installation_guide

  assign show_electrician_warning = false
  for collection in section.settings.electrician_collections
    if product.collections contains collection
      assign show_electrician_warning = true
      break
    endif
  endfor
-%}

<div
  class="installation-guide full-width"
  style="
    --section-padding-top: {{ section.settings.section_padding_top }}px;
    --section-padding-bottom: {{ section.settings.section_padding_bottom }}px;
    --top-line-color: {{ section.settings.top_line_color }};
    --top-line-thickness: {{ section.settings.top_line_thickness }}px;
    --divider-line-color: {{ section.settings.divider_line_color }};
    --title-size-desktop: {{ section.settings.title_size_desktop }}px;
    --title-size-mobile: {{ section.settings.title_size_mobile }}px;
    --title-color: {{ section.settings.title_color }};
    --title-weight: {{ section.settings.title_weight }};
    --subtitle-size: {{ section.settings.subtitle_size }}px;
    --subtitle-color: {{ section.settings.subtitle_color }};
    --text-size-desktop: {{ section.settings.text_size_desktop }}px;
    --text-size-mobile: {{ section.settings.text_size_mobile }}px;
    --text-color: {{ section.settings.text_color }};
    --text-line-height: {{ section.settings.text_line_height }};
    --warning-bg: {{ section.settings.warning_bg }};
    --warning-text-color: {{ section.settings.warning_text_color }};
    --warning-icon-color: {{ section.settings.warning_icon_color }};
    --warning-text-size-desktop: {{ section.settings.warning_text_size_desktop }}px;
    --warning-text-size-mobile: {{ section.settings.warning_text_size_mobile }}px;
    --line-spacing-desktop: {{ section.settings.line_spacing_desktop }}px;
    --line-spacing-mobile: {{ section.settings.line_spacing_mobile }}px;
    --title-spacing-desktop: {{ section.settings.title_spacing_desktop }}px;
    --title-spacing-mobile: {{ section.settings.title_spacing_mobile }}px;
  "
>
  {% render 'scroll-animation' %}
  <div class="installation-guide__container">
    <!-- Desktop Layout -->
    <div class="installation-guide__desktop scroll-animate">
      <div class="installation-guide__top-line"></div>
      <div class="installation-guide__divider-line"></div>

      <div class="installation-guide__left">
        <h2 class="installation-guide__title">{{ section.settings.title }}</h2>
        {%- if section.settings.subtitle != blank -%}
          <p class="installation-guide__subtitle">{{ section.settings.subtitle }}</p>
        {%- endif -%}
      </div>

      <div class="installation-guide__right">
        <div class="installation-guide__content">
          {%- if installation_metafield != blank -%}
            {{ installation_metafield | metafield_tag }}
          {%- else -%}
            {{ section.settings.fallback_text }}
          {%- endif -%}
        </div>

        {%- if show_electrician_warning -%}
          <div class="installation-guide__warning">
            <span class="installation-guide__warning-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
            </span>
            <span class="installation-guide__warning-text">{{ section.settings.electrician_warning_text }}</span>
          </div>
        {%- endif -%}
      </div>
    </div>

    <!-- Mobile Layout -->
    <details class="installation-guide__mobile scroll-animate" open>
      <summary class="installation-guide__mobile-header">
        <div class="installation-guide__top-line"></div>
        <div class="installation-guide__mobile-title-row">
          <h2 class="installation-guide__title">{{ section.settings.title }}</h2>
          <span class="installation-guide__toggle">
            <span class="installation-guide__toggle-plus">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
            </span>
            <span class="installation-guide__toggle-close">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </span>
          </span>
        </div>
      </summary>

      <div class="installation-guide__mobile-content">
        <div class="installation-guide__content">
          {%- if installation_metafield != blank -%}
            {{ installation_metafield | metafield_tag }}
          {%- else -%}
            {{ section.settings.fallback_text }}
          {%- endif -%}
        </div>

        {%- if show_electrician_warning -%}
          <div class="installation-guide__warning">
            <span class="installation-guide__warning-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
            </span>
            <span class="installation-guide__warning-text">{{ section.settings.electrician_warning_text }}</span>
          </div>
        {%- endif -%}
      </div>
    </details>
  </div>
</div>

{% stylesheet %}
  .installation-guide {
    padding: var(--section-padding-top) 0 var(--section-padding-bottom) 0;
  }

  .installation-guide__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
  }

  /* Desktop Layout */
  .installation-guide__desktop {
    display: grid;
    grid-template-columns: 1fr 2fr;
    grid-template-rows: auto auto;
    column-gap: 60px;
    row-gap: var(--line-spacing-desktop);
    align-items: start;
  }

  .installation-guide__mobile {
    display: none;
  }

  .installation-guide__top-line {
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    max-width: 300px;
    height: var(--top-line-thickness);
    background: var(--top-line-color);
  }

  .installation-guide__divider-line {
    grid-column: 2;
    grid-row: 1;
    width: 100%;
    height: 1px;
    background: var(--divider-line-color);
    align-self: end;
  }

  .installation-guide__left {
    grid-column: 1;
    grid-row: 2;
    align-self: start;
  }

  .installation-guide__right {
    grid-column: 2;
    grid-row: 2;
    align-self: start;
  }

  .installation-guide__title {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--title-size-desktop);
    font-weight: var(--title-weight);
    color: var(--title-color);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 var(--title-spacing-desktop);
    padding: 0;
  }

  .installation-guide__left,
  .installation-guide__right {
    padding-top: 0;
    margin-top: 0;
  }

  .installation-guide__subtitle {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--subtitle-size);
    color: var(--subtitle-color);
    margin: 0;
  }

  .installation-guide__content {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--text-size-desktop);
    color: var(--text-color);
    line-height: var(--text-line-height);
    margin-bottom: 24px;
    margin-top: 0;
    padding-top: 0;
  }

  .installation-guide__content > * {
    margin-top: 0;
  }

  .installation-guide__content > *:first-child,
  .installation-guide__content p:first-child,
  .installation-guide__content div:first-child,
  .installation-guide__content > *:first-child * {
    margin-top: 0;
    padding-top: 0;
  }

  .installation-guide__right .installation-guide__content {
    margin-top: 0;
    padding-top: 0;
  }

  .installation-guide__right .installation-guide__content p,
  .installation-guide__right .installation-guide__content div {
    margin-top: 0;
  }

  .installation-guide__right .installation-guide__content p + p,
  .installation-guide__right .installation-guide__content div + div {
    margin-top: 1em;
  }

  /* Reset for rich text metafield output */
  .installation-guide__right .rte > *:first-child,
  .installation-guide__right .metafield-rich_text_field > *:first-child,
  .installation-guide__right [class*="metafield"] > *:first-child {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  .installation-guide__warning {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--warning-bg);
    padding: 16px 20px;
  }

  .installation-guide__warning-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--warning-icon-color);
    flex-shrink: 0;
  }

  .installation-guide__warning-text {
    font-family: var(--font-body-family), sans-serif;
    font-size: var(--warning-text-size-desktop);
    color: var(--warning-text-color);
  }

  /* Mobile Layout */
  @media (max-width: 768px) {
    .installation-guide__container {
      padding: 0 var(--page-margin);
    }

    .installation-guide__desktop {
      display: none;
    }

    .installation-guide__mobile {
      display: block;
      width: 100%;
    }

    .installation-guide__mobile-header {
      list-style: none;
      cursor: pointer;
      width: 100%;
      display: block;
    }

    .installation-guide__mobile-header::-webkit-details-marker {
      display: none;
    }

    .installation-guide__top-line {
      max-width: none;
      margin-bottom: var(--line-spacing-mobile);
    }

    .installation-guide__mobile-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .installation-guide__title {
      font-size: var(--title-size-mobile);
      margin: 0;
    }

    .installation-guide__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--title-color);
      transition: transform 0.3s ease;
    }

    .installation-guide__toggle svg {
      transition: transform 0.3s ease;
    }

    .installation-guide__toggle-plus {
      display: block;
    }

    .installation-guide__toggle-close {
      display: none;
    }

    .installation-guide__mobile[open] .installation-guide__toggle-plus {
      display: none;
    }

    .installation-guide__mobile[open] .installation-guide__toggle-close {
      display: block;
    }

    .installation-guide__mobile-content {
      margin-top: var(--title-spacing-mobile);
      overflow: hidden;
      animation: slideDown 0.3s ease forwards;
    }

    .installation-guide__mobile:not([open]) .installation-guide__mobile-content {
      animation: slideUp 0.3s ease forwards;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        max-height: 1000px;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 1;
        max-height: 1000px;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
      }
    }

    .installation-guide__content {
      font-size: var(--text-size-mobile);
      margin-bottom: 20px;
    }

    .installation-guide__mobile-content {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box;
    }

    .installation-guide__mobile .installation-guide__content {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box;
    }

    .installation-guide__mobile .installation-guide__content p,
    .installation-guide__mobile .installation-guide__content div,
    .installation-guide__mobile .installation-guide__content span,
    .installation-guide__mobile .installation-guide__content ul,
    .installation-guide__mobile .installation-guide__content ol,
    .installation-guide__mobile .installation-guide__content li {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }

    .installation-guide__warning {
      padding: 14px 16px;
      gap: 10px;
    }

    .installation-guide__warning-text {
      font-size: var(--warning-text-size-mobile);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Installation guide",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "INSTALLATION"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Ref: Guide-V1.0"
    },
    {
      "type": "textarea",
      "id": "fallback_text",
      "label": "Fallback text",
      "info": "Shown if metafield is empty",
      "default": "Secure the fixture to an exterior wall and connect it to AC power (85â€“265 V). Use proper weather-sealing at all junctions to maintain water resistance."
    },
    {
      "type": "header",
      "content": "Electrician warning"
    },
    {
      "type": "collection_list",
      "id": "electrician_collections",
      "label": "Collections requiring electrician",
      "info": "Products in these collections will show the electrician warning"
    },
    {
      "type": "text",
      "id": "electrician_warning_text",
      "label": "Warning text",
      "default": "Qualified electrician required for safe mounting."
    },
    {
      "type": "header",
      "content": "Section"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Lines"
    },
    {
      "type": "color",
      "id": "top_line_color",
      "label": "Top line color",
      "default": "#1a1a1a"
    },
    {
      "type": "range",
      "id": "top_line_thickness",
      "label": "Top line thickness",
      "min": 1,
      "max": 8,
      "step": 1,
      "default": 4,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "divider_line_color",
      "label": "Divider line color (desktop)",
      "default": "#E5E5E5"
    },
    {
      "type": "range",
      "id": "line_spacing_desktop",
      "label": "Space below line (desktop)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "line_spacing_mobile",
      "label": "Space below line (mobile)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Title"
    },
    {
      "type": "range",
      "id": "title_size_desktop",
      "label": "Size (desktop)",
      "min": 14,
      "max": 32,
      "step": 1,
      "default": 18,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Size (mobile)",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Color",
      "default": "#1a1a1a"
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Weight",
      "options": [
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "title_spacing_desktop",
      "label": "Space below title (desktop)",
      "min": 0,
      "max": 32,
      "step": 2,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "title_spacing_mobile",
      "label": "Space below title (mobile)",
      "min": 0,
      "max": 32,
      "step": 2,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Subtitle"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Size",
      "min": 10,
      "max": 18,
      "step": 1,
      "default": 13,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Color",
      "default": "#888888"
    },
    {
      "type": "header",
      "content": "Description text"
    },
    {
      "type": "range",
      "id": "text_size_desktop",
      "label": "Size (desktop)",
      "min": 14,
      "max": 24,
      "step": 1,
      "default": 18,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "text_size_mobile",
      "label": "Size (mobile)",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color",
      "default": "#1a1a1a"
    },
    {
      "type": "select",
      "id": "text_line_height",
      "label": "Line height",
      "options": [
        { "value": "1.4", "label": "Tight" },
        { "value": "1.6", "label": "Normal" },
        { "value": "1.8", "label": "Relaxed" },
        { "value": "2", "label": "Loose" }
      ],
      "default": "1.6"
    },
    {
      "type": "header",
      "content": "Warning box"
    },
    {
      "type": "color",
      "id": "warning_bg",
      "label": "Background",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "warning_text_color",
      "label": "Text color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "warning_icon_color",
      "label": "Icon color",
      "default": "#D97706"
    },
    {
      "type": "range",
      "id": "warning_text_size_desktop",
      "label": "Text size (desktop)",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "warning_text_size_mobile",
      "label": "Text size (mobile)",
      "min": 12,
      "max": 18,
      "step": 1,
      "default": 14,
      "unit": "px"
    }
  ],
  "presets": [
    {
      "name": "Installation guide"
    }
  ],
  "templates": ["product"]
}
{% endschema %}
